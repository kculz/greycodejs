# Email Service Quick Reference

## ðŸš€ Setup (One-Time)

```bash
npm run cli -- setup-email
```

---

## ðŸ“§ Basic Usage

### Send Simple Email
```javascript
const EmailService = require('./services/EmailService');

await EmailService.send({
  to: 'user@example.com',
  subject: 'Hello',
  html: '<h1>Hi there!</h1>'
});
```

### Send With Template
```javascript
await EmailService.sendTemplate({
  to: 'user@example.com',
  subject: 'Welcome',
  template: 'welcome',
  data: { userName: 'John' }
});
```

---

## ðŸŽ¨ Pre-Built Emails

```javascript
// Welcome email
await EmailService.sendWelcomeEmail(user);

// Password reset
await EmailService.sendPasswordResetEmail(user, resetToken);

// Email verification
await EmailService.sendVerificationEmail(user, verificationToken);
```

---

## âš¡ Background Queue (Async)

```javascript
const EmailQueue = require('./middlewares/email-queue');

// Queue instead of sending immediately
await EmailQueue.sendWelcomeEmail(user);

// High priority
await EmailQueue.send(options, { priority: 1 });

// Delayed send (1 hour)
await EmailQueue.send(options, { delay: 3600000 });
```

---

## ðŸ”§ Configuration (.env)

### SMTP (Gmail, Mailtrap, etc.)
```env
EMAIL_PROVIDER=smtp
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
```

### SendGrid
```env
EMAIL_PROVIDER=sendgrid
SENDGRID_API_KEY=SG.xxxxx
```

### AWS SES
```env
EMAIL_PROVIDER=ses
AWS_ACCESS_KEY_ID=AKIAxxxxx
AWS_SECRET_ACCESS_KEY=xxxxx
```

---

## ðŸ“ Custom Templates

1. Create `templates/emails/my-template.ejs`
2. Use in code:
```javascript
await EmailService.sendTemplate({
  to: 'user@example.com',
  subject: 'My Email',
  template: 'my-template',
  data: { name: 'John', code: '12345' }
});
```

---

## ðŸ§ª Testing

```bash
# Run test suite
node scripts/test-email-system.js

# Send test email via CLI
npm run cli -- setup-email --skip-install
```

---

## ðŸ› Common Issues

### Authentication Failed
- Gmail: Use App Password, not regular password
- Enable 2FA â†’ Generate App Password

### Emails Not Arriving
1. Check spam folder
2. Check logs: `logs/combined.log`
3. Verify `EMAIL_FROM` is valid

### Queue Not Working
```bash
# Start Redis
redis-server

# Test Redis
redis-cli ping
# Should return: PONG
```

---

## ðŸ“Š Monitoring

```javascript
// Get queue stats
const stats = await EmailQueue.getStats();
console.log(stats);
// { waiting: 5, active: 2, completed: 100, failed: 1 }

// Test connection
const status = await EmailService.testConnection();
console.log(status);
// { success: true, provider: 'smtp' }
```

---

## ðŸ’¡ Pro Tips

1. **Always queue in production** - Better performance
2. **Use text + HTML** - Better deliverability
3. **Test templates** - Check rendering across clients
4. **Rate limit endpoints** - Prevent abuse
5. **Log everything** - Track delivery issues

---

## ðŸ”— Integration Examples

### With Registration
```javascript
// controllers/AuthController.js
const register = async (req, res) => {
  const user = await User.create(req.body);
  await EmailService.sendWelcomeEmail(user);
  return res.status(201).json({ user });
};
```

### Password Reset Flow
```javascript
const forgotPassword = async (req, res) => {
  const user = await User.findOne({ email: req.body.email });
  const token = crypto.randomBytes(32).toString('hex');
  await EmailService.sendPasswordResetEmail(user, token);
  return res.json({ message: 'Check your email' });
};
```

---

## ðŸ“¦ Dependencies

```bash
# Core
npm install nodemailer ejs

# Providers (install as needed)
npm install @sendgrid/mail  # SendGrid
npm install aws-sdk         # AWS SES
npm install mailgun-js      # Mailgun

# Queue (optional)
npm install bull redis
```

---

## ðŸ†˜ Need Help?

- Full docs: `EMAIL_SETUP.md`
- Test system: `node scripts/test-email-system.js`
- Reconfigure: `npm run cli -- setup-email`

---

**Quick Start Checklist:**

- [ ] Run setup: `npm run cli -- setup-email`
- [ ] Configure `.env` with provider credentials
- [ ] Test connection: `node scripts/test-email-system.js`
- [ ] Send test email
- [ ] Integrate with auth/registration
- [ ] Deploy and monitor

---

*Generated by GreyCodeJS Email Service*